<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Редактирование пользователя</title>
    <link href="dist/css/style.css" rel="stylesheet">
  </head>

  <body class="page-wrapper">
    <main class="page-content">
      <form class="user-edit" action="" method="POST" v-cloak>
        <user-form v-bind:user="user" v-if="user"></user-form>
        <div class="user-edit__empty" v-else>Такого пользователя нет</div>
      </form>

      <template id="user-form">
        <table class="user-edit__data">
          <tbody>
            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">Баланс</td>
              <td class="user-edit__data-value">
                <input type="text" name="balance" v-bind:value="user.balance">
              </td>
            </tr>

            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">Ссылка на аватар</td>
              <td class="user-edit__data-value">
                <input type="text" name="picture" v-bind:value="user.picture">
              </td>
            </tr>

            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">Возраст</td>
              <td class="user-edit__data-value">
                <input type="number" name="age" v-bind:value="user.age">
              </td>
            </tr>

            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">Имя</td>
              <td class="user-edit__data-value">
                <input type="text" name="firstName" v-bind:value="user.firstName">
              </td>
            </tr>

            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">Фамилия</td>
              <td class="user-edit__data-value">
                <input type="text" name="lastName" v-bind:value="user.lastName">
              </td>
            </tr>

            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">Компания</td>
              <td class="user-edit__data-value">
                <input type="text" name="company" v-bind:value="user.company">
              </td>
            </tr>

            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">E-Mail</td>
              <td class="user-edit__data-value">
                <input type="email" name="email" v-bind:value="user.email">
              </td>
            </tr>

            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">Телефон</td>
              <td class="user-edit__data-value">
                <input type="tel" name="phone" v-bind:value="user.phone">
              </td>
            </tr>

            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">Адрес</td>
              <td class="user-edit__data-value">
                <input type="text" name="address" v-bind:value="user.address">
              </td>
            </tr>

            <tr class="user-edit__data-row">
              <td class="user-edit__data-option">О себе</td>
              <td class="user-edit__data-value">
                <textarea name="about">{{ user.about }}</textarea>
              </td>
            </tr>
          </tbody>
        </table>
      </template>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
      'use strict';

      var UserForm = {
        name: 'UserForm',

        template: '#user-form',

        props: {
          user: {
            type: Object,
            required: true
          }
        }
      }

      window.userForm = new Vue({
        el: '.user-edit',

        components: {
          'user-form': UserForm
        },

        data: function() {
          return {
            user: {},
            userId: +location.search.split('=')[1],
          }
        },

        watch: {
          userId: {
            handler: function(newVal) {
              axios.get('http://localhost:3004/users')
                .then( (response) => {
                  this.user = response.data.filter( (item) => (item.id === this.userId) )[0]
                })
                .catch( (error) => ( console.error(error)) );
            },

            immediate: true
          }
        },
      });
    </script>
  </body>
</html>
